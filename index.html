<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            background: transparent;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            user-select: none;
        }
        #container {
            display: inline-block;
            text-align: center;
        }
        #message {
            font-family: Arial, sans-serif;
            font-size: 24px;
            color: green;
            display: none;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="message">ПИПИДАСТР</div>
    </div>

    <script>
        const message = document.getElementById('message');
        let shakeTimeout;
        let shakeCount = 0;
        let messageShown = false;
        let lastShakeTime = 0;
        const SHAKE_THRESHOLD = 15; // Порог силы тряски
        const SHAKE_INTERVAL = 300; // Минимальный интервал между трясками (мс)
        const REQUIRED_TIME = 5000; // 5 секунд тряски
        let totalShakeTime = 0;
        let shakeStartTime = null;
        let isShaking = false;

        // Данные с акселерометра
        let lastX = null, lastY = null, lastZ = null;

        function handleMotion(event) {
            if (messageShown) return; // Если сообщение уже показано, ничего не делаем

            const acceleration = event.accelerationIncludingGravity;
            const currentTime = Date.now();

            if (lastX !== null && lastY !== null && lastZ !== null) {
                const deltaX = Math.abs(lastX - acceleration.x);
                const deltaY = Math.abs(lastY - acceleration.y);
                const deltaZ = Math.abs(lastZ - acceleration.z);

                // Определяем тряску
                if ((deltaX > SHAKE_THRESHOLD || deltaY > SHAKE_THRESHOLD || deltaZ > SHAKE_THRESHOLD) &&
                    (currentTime - lastShakeTime) > SHAKE_INTERVAL) {
                    
                    lastShakeTime = currentTime;
                    
                    if (!isShaking) {
                        // Начало тряски
                        isShaking = true;
                        shakeStartTime = currentTime;
                    } else {
                        // Продолжение тряски
                        totalShakeTime = currentTime - shakeStartTime;
                        
                        // Проверяем, набрали ли мы 5 секунд
                        if (totalShakeTime >= REQUIRED_TIME) {
                            showMessage();
                        }
                    }
                } else {
                    // Если тряска прекратилась
                    if (isShaking) {
                        const timeSinceLastShake = currentTime - lastShakeTime;
                        
                        // Если прошло больше 500мс без тряски - сбрасываем
                        if (timeSinceLastShake > 500) {
                            resetShakeCounter();
                        }
                    }
                }
            }

            // Сохраняем текущие значения для следующего сравнения
            lastX = acceleration.x;
            lastY = acceleration.y;
            lastZ = acceleration.z;
        }

        function showMessage() {
            message.style.display = 'block';
            messageShown = true;
            
            // Отписываемся от событий акселерометра
            window.removeEventListener('devicemotion', handleMotion);
        }

        function resetShakeCounter() {
            isShaking = false;
            shakeStartTime = null;
            totalShakeTime = 0;
        }

        // Запрашиваем разрешение на доступ к акселерометру (для iOS 13+)
        if (typeof DeviceMotionEvent.requestPermission === 'function') {
            DeviceMotionEvent.requestPermission()
                .then(permissionState => {
                    if (permissionState === 'granted') {
                        window.addEventListener('devicemotion', handleMotion);
                    }
                })
                .catch(console.error);
        } else {
            // Для Android и других браузеров
            window.addEventListener('devicemotion', handleMotion);
        }

        // Обработчик для демо-режима на компьютере
        document.addEventListener('keydown', function(e) {
            if (e.code === 'Space' && !messageShown) {
                // Симуляция тряски для тестирования на ПК
                if (!isShaking) {
                    isShaking = true;
                    shakeStartTime = Date.now();
                }
                
                totalShakeTime = Date.now() - shakeStartTime;
                
                if (totalShakeTime >= REQUIRED_TIME) {
                    showMessage();
                }
            }
        });

        document.addEventListener('keyup', function(e) {
            if (e.code === 'Space') {
                resetShakeCounter();
            }
        });
    </script>
</body>
</html>
