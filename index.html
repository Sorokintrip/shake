<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #ffffff;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        
        #spoiler {
            font-size: 20px;
            font-weight: bold;
            color: #00FF00;
            display: none;
            cursor: default;
            max-width: 200px;
            text-align: center;
            line-height: 1.4;
            text-shadow: 0 0 10px #00FF00;
        }
    </style>
</head>
<body>
    <div id="spoiler"></div>

    <script>
        // Флаг для отслеживания состояния
        let spoilerRevealed = false;
        let isShaking = false;
        let shakeCount = 0;
        let shakeTimer = null;
        let lastShakeTime = 0;
        
        const SHAKE_THRESHOLD = 15;
        const SHAKE_DURATION = 5000; // 5 секунд
        const SHAKE_INTERVAL = 200;
        
        const spoilerElement = document.getElementById('spoiler');
        
        // Показываем спойлер
        function showSpoiler() {
            if (spoilerRevealed) return;
            
            spoilerRevealed = true;
            spoilerElement.textContent = 'Код спойлера: ЮЗИЛИЩЕ';
            spoilerElement.style.display = 'block';
            spoilerElement.style.color = '#00FF00';
            spoilerElement.style.fontSize = '20px';
            spoilerElement.style.fontWeight = 'bold';
            
            // Останавливаем отслеживание тряски
            window.removeEventListener('devicemotion', handleMotion);
        }
        
        // Обработчик движения устройства
        function handleMotion(event) {
            if (spoilerRevealed || !event.accelerationIncludingGravity) return;
            
            const acceleration = event.accelerationIncludingGravity;
            const currentTime = Date.now();
            
            // Защита от слишком частых срабатываний
            if (currentTime - lastShakeTime < SHAKE_INTERVAL) {
                return;
            }
            
            // Рассчитываем силу тряски
            const shakeForce = Math.abs(acceleration.x) + 
                              Math.abs(acceleration.y) + 
                              Math.abs(acceleration.z);
            
            if (shakeForce > SHAKE_THRESHOLD) {
                lastShakeTime = currentTime;
                
                if (!isShaking) {
                    isShaking = true;
                    shakeCount = 0;
                    
                    // Запускаем таймер
                    shakeTimer = setInterval(() => {
                        shakeCount += 100;
                        
                        if (shakeCount >= SHAKE_DURATION) {
                            clearInterval(shakeTimer);
                            isShaking = false;
                            showSpoiler();
                        }
                    }, 100);
                }
            }
        }
        
        // Инициализация
        function init() {
            // Проверяем, поддерживается ли DeviceMotion
            if (!window.DeviceMotionEvent) {
                console.log('DeviceMotion не поддерживается');
                return;
            }
            
            // Для iOS 13+ нужен явный запрос разрешения
            if (typeof DeviceMotionEvent.requestPermission === 'function') {
                // Создаем кнопку для запроса разрешения (невидимую)
                const permissionBtn = document.createElement('button');
                permissionBtn.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    opacity: 0;
                    cursor: pointer;
                    z-index: 9999;
                `;
                permissionBtn.textContent = '';
                document.body.appendChild(permissionBtn);
                
                permissionBtn.onclick = function() {
                    DeviceMotionEvent.requestPermission()
                        .then(permissionState => {
                            if (permissionState === 'granted') {
                                startMotionTracking();
                                document.body.removeChild(permissionBtn);
                            }
                        })
                        .catch(console.error);
                    return false;
                };
            } else {
                // Для Android и других устройств
                startMotionTracking();
            }
        }
        
        function startMotionTracking() {
            window.addEventListener('devicemotion', handleMotion);
        }
        
        // Сброс таймера при отсутствии движения
        let inactivityTimer;
        function resetShakeTimer() {
            if (isShaking && !spoilerRevealed) {
                clearTimeout(inactivityTimer);
                inactivityTimer = setTimeout(() => {
                    if (isShaking) {
                        clearInterval(shakeTimer);
                        isShaking = false;
                        shakeCount = 0;
                    }
                }, 500);
            }
        }
        
        // Добавляем обработчик для сброса
        window.addEventListener('devicemotion', resetShakeTimer);
        
        // Запускаем при загрузке страницы
        document.addEventListener('DOMContentLoaded', init);
        
        // Альтернативный способ для тестирования (работает в iframe)
        document.addEventListener('click', function() {
            // Если долго жмем (3 секунды), показываем спойлер для теста
            let clickTimer = setTimeout(() => {
                if (!spoilerRevealed) {
                    showSpoiler();
                }
            }, 3000);
            
            document.addEventListener('mouseup', function cancelTest() {
                clearTimeout(clickTimer);
                document.removeEventListener('mouseup', cancelTest);
            });
        });
        
    </script>
</body>
</html>
